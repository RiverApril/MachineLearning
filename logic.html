<html>

<head>
  <script type="application/javascript" src="neuralNetwork.js"></script>
  <script type="application/javascript" src="renderer.js"></script>
  <script type="application/javascript">
    
    var canvas, context;
    
    var teaching;
    var topology;
    var nn;
    
    var learningRate;
    var epochs;
    var diff;
    var diffs;
    
    window.onload = function () {
      'use strict';

      teaching = [
        {in:[0, 0], out:[0]},
        {in:[0, 1], out:[1]},
        {in:[1, 0], out:[1]},
        {in:[1, 1], out:[0]},
      ];
      
      topology = [2, 2, 1];
      
      nn = new Network(topology);
      
      initalizeRenderer("mainCanvas", nn);

      learningRate = 0.2;
      epochs = 0;

      diff = 1;
      diffs = [];


      var update = function(){
        context.fillStyle = "#FFFFFF";
        context.fillRect(0, 0, context.canvas.width, context.canvas.height);
        
        context.strokeText("Epoch: "+epochs, 0, fontH);
        context.strokeText("Mean Error: "+(diff * 100.0).toFixed(5)+"%", 0, fontH*2);
        
        diff = 0;
        for(var set = 0; set < teaching.length; set++){
          nn.calculate(teaching[set].in);
          nn.learn(teaching[set].out, learningRate);
          for (var o = 0; o < teaching[set].out.length; o++) {
            diff = Math.max(Math.abs(nn.neurons[nn.neurons.length - 1][o].data.output-teaching[set].out[o]), diff);
          }
          diffs.push(diff);
          drawNetwork(set);
        }
        epochs++;
        
        context.strokeStyle = "#FFC0C0";
        context.beginPath();
        context.moveTo(0, (fontH * 3));
        context.lineTo(100, (fontH * 3));
        context.moveTo(0, (fontH * 3)+300);
        context.lineTo(100, (fontH * 3)+300);
        context.stroke();
        
        context.strokeStyle = "#000000";
        context.beginPath();
        for (var i = 0; i < 100; i++) {
          var y = ((1 - diffs[diffs.length - i]) * 300.0) + (fontH * 3);
          if (i == 0) {
            context.moveTo(i, y);
          } else {
            context.lineTo(i, y);
          }
        }
        context.stroke();
      
      }
      
      window.setInterval(update, 1);
      
           
    }
    
  </script>
</head>

<body>
  
  <canvas id="mainCanvas" width=400 height=400>Canvas not supported</canvas>
  
</body>

</html>