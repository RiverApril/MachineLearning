<html>

<head>
  <script type="application/javascript" src="neuralNetwork.js"></script>
  <script type="application/javascript" src="networkVisualizer.js"></script>
  <script type="application/javascript">
    
    var canvas, context;
    
    var teaching;
    var topology;
    var nn;
    var networkVis;
    
    var learningRate;
    var epochs;
    var diff;
    var diffs;
    
    window.onload = function () {
      'use strict';

      teaching = [
        {in:[0, 0], out:[0]},
        {in:[0, 1], out:[1]},
        {in:[1, 0], out:[1]},
        {in:[1, 1], out:[0]},
      ];
      
      topology = [2, 2, 1];
      
      nn = new Network(topology, teaching.length);
      
  
      canvas = document.getElementById("mainCanvas");
      context = canvas.getContext("2d");

      context.canvas.width = window.innerWidth;
      context.canvas.height = window.innerHeight;
      
      networkVis = new NetworkVisualizer(context, nn, 100, 0, context.canvas.width-100, context.canvas.height);

      learningRate = 0.2;
      epochs = 0;

      diffs = [[], [], [], []];


      var update = function(){
        context.fillStyle = "#FFFFFF";
        context.fillRect(0, 0, context.canvas.width, context.canvas.height);
        
        context.strokeStyle = "#000000";
        context.strokeText("Epoch: "+epochs, 0, networkVis.fontH);
        
        var outputs = [];
        
        for(var set = 0; set < teaching.length; set++){
          outputs.push(nn.calculate(teaching[set].in));
          nn.learn(teaching[set].out, learningRate);
          var diff = 0;
          for (var o = 0; o < teaching[set].out.length; o++) {
            diff = Math.max(diff, Math.abs(nn.neurons[nn.neurons.length - 1][o].data.output-teaching[set].out[o]));
          }
          diffs[set].push(diff);
        }
        networkVis.draw();
        epochs++;
        
        var graphY = (networkVis.fontH * 3);
        var graphH = 100;
        var graphW = 100;
        
        context.strokeStyle = "#FFC0C0";
        context.beginPath();
        context.moveTo(0, graphY);
        context.lineTo(graphW, graphY);
        context.moveTo(0, graphY+graphH);
        context.lineTo(graphW, graphY+graphH);
        context.stroke();
        
        for(var set = 0; set < teaching.length; set++){
          context.strokeStyle = "#C0C0C0";
          context.beginPath();
          for (var i = 0; i < graphW; i++) {
            var y = ((1 - diffs[set][Math.ceil(diffs[set].length / graphW * i)]) * graphH) + graphY;
            if (i == 0) {
              context.moveTo(i, y);
            } else {
              context.lineTo(i, y);
            }
          }
          context.stroke();
          context.strokeStyle = "#000000";
          for (var i = 0; i < outputs[set].length; i++) {
            outputs[set][i] = Number(outputs[set][i].toFixed(4));
          }
          var str = JSON.stringify(teaching[set].in) + " -> " + JSON.stringify(teaching[set].out) + " ~ " + JSON.stringify(outputs[set]);
          context.strokeText(str, 0, graphY + graphH + (16*(set+2)));
        }
      
      }
      
      window.setInterval(update, 1);
      
           
    }
    
  </script>
</head>

<body>
  
  <canvas id="mainCanvas" width=400 height=400>Canvas not supported</canvas>
  
</body>

</html>